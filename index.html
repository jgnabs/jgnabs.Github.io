<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Pisces","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"AL8WZYWIU5","apiKey":"cd3eeb6b327eb1799d492c071a089d71","indexName":"hexo_algolia","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="秀外慧中流砥柱">
<meta property="og:type" content="website">
<meta property="og:title" content="SpaceX">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="SpaceX">
<meta property="og:description" content="秀外慧中流砥柱">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="SpaceX">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>SpaceX</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">SpaceX</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">人生苦短，先学Java</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="search-pop-overlay">
  <div class="popup search-popup">
      <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

    
  </div>
</div>

  </div>
</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/13/online-compiler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/13/online-compiler/" class="post-title-link" itemprop="url">在线编译器</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-13 17:19:47" itemprop="dateCreated datePublished" datetime="2020-03-13T17:19:47+08:00">2020-03-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong><em>在线代码编译不需要IDE，不需要开发环境</em></strong></p>
<p><a href="https://www.ideone.com" target="_blank" rel="noopener">https://www.ideone.com</a></p>
<blockquote>
<p>在线的编译和调试工具，你可以在线编译代码并执行，其所支持的编程语言高达80多种。</p>
</blockquote>
<p><a href="https://code.hackerearth.com/" target="_blank" rel="noopener">https://code.hackerearth.com/</a></p>
<blockquote>
<p>在每次击键之后在后台编译。输入代码后，错误行在一秒钟内突出显示。编辑器具有语法高亮和自动完成功能。</p>
</blockquote>
<p><a href="https://www.codechef.com/ide" target="_blank" rel="noopener">https://www.codechef.com/ide</a></p>
<blockquote>
<p>它支持C，C ++和Java，非常接近真正的桌面IDE。这是超快速和易于使用。适合于课堂和作业的学生，练习面试问题。</p>
</blockquote>
<p><a href="https://www.onlinegdb.com/online_c_compiler" target="_blank" rel="noopener">https://www.onlinegdb.com/online_c_compiler</a></p>
<blockquote>
<p>它支持C，C ++，PHP和Java编译器。OnlineGDB的独特功能是，您可以逐步调试您的代码。一旦代码被写入，它可以很容易地格式化，使其看起来不错。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/16/CORS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/16/CORS/" class="post-title-link" itemprop="url">跨源请求</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-16 14:17:53" itemprop="dateCreated datePublished" datetime="2019-08-16T14:17:53+08:00">2019-08-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p><code>Cross-Origin Resource Sharing</code>（跨源共享）允许web客户端向不同源的服务器发出<code>http</code>请求，跨源是一种web技术，因为它同时包含客户端和服务端的组件。<br>服务端组件控制那些类型的跨源请求被允许，而客户端组件控制如何发出跨源请求。</p>
</blockquote>
<h2 id="什么是origin（源）"><a href="#什么是origin（源）" class="headerlink" title="什么是origin（源）"></a>什么是<code>origin</code>（源）</h2><p><code>origin</code> 定义了客户端你的来源。比如<code>http://localhost:1111/client.html</code>的<code>origin</code>就是<code>http://localhost:1111</code>。换句话说除了最后路径部分， 就叫做<code>origin</code>。<br>可以看出<code>origin</code>有几部分组成，协议+主机+端口，<strong>null除外</strong>。如下所示的几种<code>url</code>和它对应的<code>origin</code>：</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>ORIGIN</th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://localhost:1111" target="_blank" rel="noopener">http://localhost:1111</a></td>
<td><a href="http://localhost:1111" target="_blank" rel="noopener">http://localhost:1111</a></td>
</tr>
<tr>
<td><a href="https://localhost:1111/client.html" target="_blank" rel="noopener">https://localhost:1111/client.html</a></td>
<td><a href="https://localhost:1111" target="_blank" rel="noopener">https://localhost:1111</a></td>
</tr>
<tr>
<td>file:///Users/hossain/ch02/client.html</td>
<td>null</td>
</tr>
</tbody></table>
<p>代表<code>origin</code>的<code>header</code>值不需要我们手动设置，浏览器会自动识别请求是否是一个跨域请求，并且帮助设置<code>origin</code>。出于安全考虑，人工重写<code>origin</code>的值是无效的。<br>值得注意的是，同源请求有时也会有<code>origin</code>的值，如<code>Chrome</code>和<code>Safari</code>发送非<code>get</code>请求的时候也会发送<code>origin</code>的值。在这种情况下，<code>origin</code>的值和请求服务器的<code>origin</code>是一致的。<br>所以判断一个请求是不是是不是跨源请求的依据不仅仅是有没有<code>origin</code>，还要确认<code>origin</code>的值和请求服务器的<code>origin</code>是否一致。</p>
<h2 id="服务端如何允许跨域请求"><a href="#服务端如何允许跨域请求" class="headerlink" title="服务端如何允许跨域请求"></a>服务端如何允许跨域请求</h2><p>服务器使用响应头<code>Access-Control-Allow-Origin</code>用来允许一个客户端的跨域请求，如果返回<code>header</code>没有该值，则视为请求失败。<br><code>Access-Control-Allow-Origin</code>的值可以是一个通配符，亦可以是一个<code>origin</code>。如下所示：</p>
<p>Access-Control-Allow-Origin: *<br>Access-Control-Allow-Origin: <a href="http://localhost:1111" target="_blank" rel="noopener">http://localhost:1111</a></p>
<p><code>Access-Control-Allow-Origin: *</code>代表的是任何客户端可以访问我的资源。<br><code>Access-Control-Allow-Origin: http://localhost:1111</code>代表只有<code>origin</code>为<code>http://localhost:1111</code>的客户端可以访问我的资源。</p>
<p>该响应头的信息设置只支持<code>*</code>或者一个标准的<code>origin</code>。<br><strong>所以，如果想要拒绝一个跨域请求，返回一个不用的<code>origin</code>，或者不返回该值即可</strong></p>
<blockquote>
<p>但是很多时候单纯设置<code>Access-Control-Allow-Origin</code>是不够的，比如<code>DELETE</code>或者<code>PUT</code>在发送真正的请求之时需要先一步的询问服务端的权限。该步骤就是<code>preflight request</code></p>
</blockquote>
<h2 id="预检请求（preflight-request）"><a href="#预检请求（preflight-request）" class="headerlink" title="预检请求（preflight request）"></a>预检请求（preflight request）</h2><p>预检请求就是在客户端发送真实请求之前会先发送一个预检请求先询问服务端是否有权限。换句话说，先询问一下服务端浏览器是否可以发送该请求。<br>预检请求使用<code>options</code>方法。如果预检响应失败，则不会发送真实的请求。</p>
<p>除了预检响应可以返回允许的<code>origin</code> 之外，允许返回支持跨源请求的方法。如：<br><code>Access-Control-Allow-Methods: HEAD, GET, POST, PUT, DELETE</code></p>
<p>除了预检响应可以返回支持的方法，也可以返回允许的<code>header</code>。如：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Preflight request: </span><br><span class="line"><span class="keyword">OPTIONS</span> <span class="string">/api/posts</span> HTTP/1.1</span><br><span class="line"><span class="attribute">User-Agent</span>: Chrome</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:9999</span><br><span class="line"><span class="attribute">Accept</span>: */*</span><br><span class="line"><span class="attribute">Origin</span>: http://localhost:1111</span><br><span class="line"><span class="attribute">Access-Control-Request-Method</span>: GET</span><br><span class="line"><span class="attribute">Access-Control-Request-Headers</span>: Timezone-Offset, Sample-Source</span><br><span class="line"></span><br><span class="line">允许发送请求头后 发送真实的请求: </span><br><span class="line"><span class="keyword">GET</span> <span class="string">/api/posts</span> HTTP/1.1</span><br><span class="line"><span class="attribute">User-Agent</span>: Chrome</span><br><span class="line"><span class="attribute">Host</span>: 127.0.0.1:9999</span><br><span class="line"><span class="attribute">Accept</span>: */*</span><br><span class="line"><span class="attribute">Origin</span>: http://localhost:1111</span><br><span class="line"><span class="attribute">Timezone-Offset</span>: 300</span><br><span class="line"><span class="attribute">Sample-Source</span>: alldios</span><br></pre></td></tr></table></figure>

<h2 id="代理服务器"><a href="#代理服务器" class="headerlink" title="代理服务器"></a>代理服务器</h2><p>不同客户端访问同一个代理服务器，可能会造成一些缓存上的问题。如<code>http://tablet.espn.com</code>的客户端访问代理服务器的<code>API</code>返回<code>http://tablet.tencent.com</code>的<code>origin</code>，<br>而<code>http://mobile.tencent.com</code>访问相同的<code>API</code>可能会根据缓存返回相同的<code>origin</code>，如还是<code>http://tablet.tencent.com</code>。这会导致后者的请求失败。<br>如要需要解决这种问题，可以设置请求头<code>Vary: Origin</code>。如果设置该请求头，服务器将会视<code>Origin: http://mobile.tencent.com</code>和<code>Origin:http://tablet.tencent.com</code>为不同的请求。   </p>
<p>预检请求出发需要一定的条件，触发机制<a href="https://developer.mozilla.org/zh/docs/Web/HTTP/Access_control_CORS" target="_blank" rel="noopener">参考</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/02/java-generics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/06/02/java-generics/" class="post-title-link" itemprop="url">java泛型</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-02 09:07:21" itemprop="dateCreated datePublished" datetime="2019-06-02T09:07:21+08:00">2019-06-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><ul>
<li><code>type parameter</code>，类型形参。如<code>Collection&lt;Integer&gt;</code>，该声明的类型形参是<code>Integer</code>。</li>
<li><code>parameterized type</code>，参数化类型。如<code>new Array&lt;Integer&gt;</code>，该调用的参数化类型是<code>Integer</code>。</li>
<li><code>type variable</code>，类型变量。如类声明<code>public class Canvas&lt;T&gt;</code> ，<code>T</code>就是类型变量。</li>
</ul>
<h2 id="什么是泛型"><a href="#什么是泛型" class="headerlink" title="什么是泛型"></a>什么是泛型</h2><blockquote>
<p>泛型是从J2SE 5.0引入的一个增强特性，允许类型和方法操作各种类型的对象同时提供编译时类型的安全性检查。另外也增加了集合编译时类型的安全性检查，消除了之前需强制转换的繁重工作。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List myIntList &#x3D; new LinkedList(); &#x2F;&#x2F; 1</span><br><span class="line">myIntList.add(new Integer(0)); &#x2F;&#x2F; 2</span><br><span class="line">Integer x &#x3D; (Integer) myIntList.iterator().next(); &#x2F;&#x2F; 3</span><br></pre></td></tr></table></figure>

<p>如上述代码，第3行是很烦人的，通常情况下，开发者知道何种类型的数据会被添加到集合，但是强制转换还是必须的，因为编译器只会保证<code>iterator()</code>方法返回的是一个对象。<br>然而为了保证对<code>Integer x</code>的赋值是正确的，还是需要进行一次强制类型转换。<br>这样除了带来无关逻辑的混乱，还有可能导致运行时异常，因为开发者是会出错的。</p>
<p>使用泛型优化后的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; myIntList &#x3D; new LinkedList&lt;Integer&gt;(); &#x2F;&#x2F; 1&#39;</span><br><span class="line">myIntList.add(new Integer(0)); &#x2F;&#x2F; 2&#39;</span><br><span class="line">Integer x &#x3D; myIntList.iterator().next(); &#x2F;&#x2F; 3&#39;</span><br></pre></td></tr></table></figure>

<p>我们为泛型集合接口<code>List</code>传入了一个类型形参（<code>Type Parameter</code>）<code>Integer</code>，不仅去除了强制转换，也告诉开发人员和编译器该<code>List</code>存储的类型，也使得编译器可以在编译时进行类型的安全检查。</p>
<h2 id="泛类和子类"><a href="#泛类和子类" class="headerlink" title="泛类和子类"></a>泛类和子类</h2><p>下述代码会出现问题吗？相信很多不了解泛型的人员都会回答没有问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; ls &#x3D; new ArrayList&lt;String&gt;(); &#x2F;&#x2F; 1</span><br><span class="line">List&lt;Object&gt; lo &#x3D; ls; &#x2F;&#x2F; 2</span><br></pre></td></tr></table></figure>

<p>这个问题的争议点就是：<code>List&lt;String&gt;</code>是不是<code>List&lt;Object&gt;</code>？     </p>
<p>如果有人回答是的话，请看下述的代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lo.add(new Object()); &#x2F;&#x2F; 3</span><br><span class="line">String s &#x3D; ls.get(0); &#x2F;&#x2F; 4: 尝试将一个对象赋值给一个字符引用</span><br></pre></td></tr></table></figure>

<p>答案是：会出问题，如果编译时不出问题的话，运行时也会出现问题。<strong>事实上，编译器在编译期间就会提示编译错误</strong>。</p>
<p>所以<code>List&lt;String&gt;</code>不是<code>List&lt;Object&gt;</code>的子类型，也就不是<code>List&lt;Object&gt;</code>。如此，泛型是来解决遗留问题的，不是而产生问题的，理解泛型就要有这个认知。</p>
<h2 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h2><p>对比如下两段代码，它们需要打印了一个集合的所有元素，哪一种更有效？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void printCollection(Collection c) &#123;</span><br><span class="line">    Iterator i &#x3D; c.iterator();</span><br><span class="line">    for (k &#x3D; 0; k &lt; c.size(); k++) &#123;</span><br><span class="line">        System.out.println(i.next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">void printCollection(Collection&lt;Object&gt; c) &#123;</span><br><span class="line">    for (Object e : c) &#123;</span><br><span class="line">        System.out.println(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>答案是：第一种更有效。尽管第二种引入了泛型，然而第一种可以接受任何类型的集合进行迭代，第二种则只会接受<code>Collection&lt;Object&gt;</code>。<br>如上一节所讲，<code>Collection&lt;Object&gt;</code>不是所有集合的超类，它不能接受<code>Collection&lt;String&gt;</code>或<code>Collection&lt;Integer&gt;</code>。</p>
<p>那么，如何使用泛型代表所有集合的超类，答案就是 <code>Collection&lt;?&gt;</code>，读作未知类集合，即可以存储任何元素类型的集合，该方式叫做通配符类型。</p>
<p>现在我们就可以使用通配符类型来匹配各种类型的集合， 并且享受编译时类型安全检查的好处。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Collection&lt;?&gt; c &#x3D; new ArrayList&lt;String&gt;(); &#x2F;&#x2F;line 1</span><br><span class="line">&#x2F;&#x2F; Collection&lt;?&gt; c &#x3D; new ArrayList&lt;&gt;(); &#x2F;&#x2F;line 2</span><br><span class="line">c.add(new Object()); &#x2F;&#x2F; 编译异常</span><br><span class="line">c.add(null);</span><br></pre></td></tr></table></figure>

<p>现在我们不知道<code>c</code>的元素类型代表什么，所以我们不能把<code>Object</code>添加进去。而<code>add</code>方法只接受<code>E</code>类型的元素，即<code>String</code>元素。<br>如果把<code>line 1</code>替换为<code>line 2</code>，则add接受的则必须是<code>?</code>（unknown）的类或子类，但是我们不知道unknown的类型，所以我们也不能添加任何类型的元素，除了<code>null</code>，因为<code>null</code>是所有类型的成员。</p>
<h3 id="边界通配符"><a href="#边界通配符" class="headerlink" title="边界通配符"></a>边界通配符</h3><p>看下面一段代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Shape &#123;</span><br><span class="line">    public abstract void draw(Canvas c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Circle extends Shape &#123;</span><br><span class="line">    private int x, y, radius;</span><br><span class="line">    public void draw(Canvas c) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Rectangle extends Shape &#123;</span><br><span class="line">    private int x, y, width, height;</span><br><span class="line">    public void draw(Canvas c) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Canvas &#123;</span><br><span class="line">    public void draw(Shape s) &#123;</span><br><span class="line">        s.draw(this);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void drawAll(List&lt;Shape&gt; shapes) &#123;</span><br><span class="line">    for (Shape s: shapes) &#123;</span><br><span class="line">        s.draw(this);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于前几节所讲，<code>drawAll</code>可以写入<code>List&lt;Shape&gt;</code>，但不可以写入<code>List&lt;Rectangle&gt;</code>或者<code>List&lt;Circle&gt;</code>，那么如果实现可以写入后两者呢？</p>
<p>答案就是使用边界统配符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void drawAll(List&lt;? extends Shape&gt; shapes) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>List&lt;? extends Shape&gt;</code>就是边界通配符的一个例子，<code>?</code>代表的还是unknown，即unknown必须是<code>Shape</code>或子类。我们称之为<code>Shape</code>是通配符的上边界。<br>当然<code>List&lt;Rectangle&gt;</code>或<code>List&lt;Circle&gt;</code>是符合的，因为<code>Rectangle</code>和<code>Circle</code>是<code>Shape</code>的子类。</p>
<p>当然这是有代价的，比如下面的<code>addRectangle</code>方法会出现编译错误，因为我们不知道<code>?</code>的类型，所以我们也不知道<code>?</code>是不是<code>Rectangle</code>的父类，所以该操作就不允许。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void addRectangle(List&lt;? extends Shape&gt; shapes) &#123;</span><br><span class="line">    &#x2F;&#x2F; Compile-time error!</span><br><span class="line">    shapes.add(0, new Rectangle());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h2><p>现在书写一个程序将一个对象数组放置到一个集合中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static void fromArrayToCollection(Object[] a, Collection&lt;?&gt; c) &#123;</span><br><span class="line">    for (Object o : a) &#123; </span><br><span class="line">        c.add(o); &#x2F;&#x2F; 编译时异常</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述程序还是犯了一个初学泛型的错误。不能将一个对象添加到<code>?</code>(unknown)的集合中。</p>
<p>解决该问题的方式就是使用泛型方法，就像类型声明一样，方法也有泛型声明，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static &lt;T&gt; void fromArrayToCollection(T[] a, Collection&lt;T&gt; c) &#123;</span><br><span class="line">    for (T o : a) &#123;</span><br><span class="line">        c.add(o); &#x2F;&#x2F; Correct</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们就可以调用该方法，只要数组的元素类型是集合类型的<code>T</code>或子类即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Object[] oa &#x3D; new Object[100];</span><br><span class="line">Collection&lt;Object&gt; co &#x3D; new ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; T 被推断为 Object</span><br><span class="line">fromArrayToCollection(oa, co); </span><br><span class="line"></span><br><span class="line">String[] sa &#x3D; new String[100];</span><br><span class="line">Collection&lt;String&gt; cs &#x3D; new ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; T 被推断为 String</span><br><span class="line">fromArrayToCollection(sa, cs);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; T 被推断为 Object</span><br><span class="line">fromArrayToCollection(sa, co);</span><br><span class="line"></span><br><span class="line">Integer[] ia &#x3D; new Integer[100];</span><br><span class="line">Float[] fa &#x3D; new Float[100];</span><br><span class="line">Number[] na &#x3D; new Number[100];</span><br><span class="line">Collection&lt;Number&gt; cn &#x3D; new ArrayList&lt;Number&gt;();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; T 被推断为 Number</span><br><span class="line">fromArrayToCollection(ia, cn);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; T 被推断为 Number</span><br><span class="line">fromArrayToCollection(fa, cn);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; T 被推断为 Number</span><br><span class="line">fromArrayToCollection(na, cn);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; T 被推断为 Object</span><br><span class="line">fromArrayToCollection(na, co);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 编译异常</span><br><span class="line">fromArrayToCollection(na, cs);</span><br></pre></td></tr></table></figure>

<p>编译器会自动推断较为具体的类型以保证调用的类型正确。</p>
<p>那么我们该如何在泛型方法和通配符类型中选择呢？我们看一下<code>API</code>中的<code>Collection</code>的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Collection&lt;E&gt; &#123;</span><br><span class="line">    public boolean containsAll(Collection&lt;?&gt; c);</span><br><span class="line">    public boolean addAll(Collection&lt;? extends E&gt; c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为什么官方不使用如下的泛型方法取代呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface Collection&lt;E&gt; &#123;</span><br><span class="line">    public &lt;T&gt; boolean containsAll(Collection&lt;T&gt; c);</span><br><span class="line">    public &lt;T extends E&gt; boolean addAll(Collection&lt;T&gt; c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>containsAll</code>,<code>addAll</code>方法中，类型形参<code>T</code>只被使用了一次，并且返回值与<code>T</code>没有任何的依赖关系。这种场景单纯就是告诉我们类型参数只是用来进行多态的使用，<br>它唯一的作用就是让实参类型更加的多样化，这种情况使用<code>?</code>通配符则是最好的方式。</p>
<p><strong>通配符设计就是为了更加灵活的子类型使用</strong></p>
<p>泛型方法允许使用类型形参来表示方法的形参和返回值类型的关系。如果没有类似的依赖关系，则不应该使用泛型方法。</p>
<p>当然它们也可以一起同时使用，比如<code>Collections.copy()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Collections &#123;</span><br><span class="line">    public static &lt;T&gt; void copy(List&lt;T&gt; dest, List&lt;? extends T&gt; src) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要注意的是两个形参的依赖关系，<code>src</code>的元素类型必须是可分配给<code>dest</code>的元素类型<code>T</code>的，所以<code>src</code>的元素类型必须是<code>T</code>或者子类。<br><code>copy</code>方法的签名就表明了这种依赖关系。</p>
<p>当然我们可以换一种写法，完全不使用通配符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Collections &#123;</span><br><span class="line">    public static &lt;T, S extends T&gt; void copy(List&lt;T&gt; dest, List&lt;S&gt; src) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样也是可以的，但是当<code>T</code>在<code>dest</code>和<code>src</code>中都使用了，<code>S</code>则只使用了一次，它并没有依赖关系。这就是可以把<code>S</code>替换为<code>?</code>的信号。<br>这就是该如何选择通配符和泛型方法两者使用的依据。</p>
<h2 id="要点"><a href="#要点" class="headerlink" title="要点"></a>要点</h2><h3 id="泛型类被所有的调用共享"><a href="#泛型类被所有的调用共享" class="headerlink" title="泛型类被所有的调用共享"></a>泛型类被所有的调用共享</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List &lt;String&gt; l1 &#x3D; new ArrayList&lt;String&gt;();</span><br><span class="line">List&lt;Integer&gt; l2 &#x3D; new ArrayList&lt;Integer&gt;();</span><br><span class="line">System.out.println(l1.getClass() &#x3D;&#x3D; l2.getClass()); &#x2F;&#x2F;line 1</span><br></pre></td></tr></table></figure>
<p><code>line 1</code>的输出是<code>true</code>，因为所有的泛型实例都有相同的运行期类型，不管它们的真实类型形参是什么。</p>
<p>这也定义了什么是泛型：即它会对所有可能的类型形参都具有相同的行为。<strong>可以理解为同一个类可以有不同的类型型参</strong>。<br>我们知道类的静态变量和静态方法在所有的实例之中共享，这也是无论在静态方法或初始值设定项中，静态变量声明或初始值设定项中引用类型声明的类型形参是非法的。<br>因为没有实例化之前，不知道静态代码中引用的类型形参<code>T</code>是什么类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Canvas&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">	static T t; &#x2F;&#x2F;编译报错</span><br><span class="line">	T t1;</span><br><span class="line">  </span><br><span class="line">	static &#123;</span><br><span class="line">		T t3; &#x2F;&#x2F;编译报错</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类型转换和实例判断"><a href="#类型转换和实例判断" class="headerlink" title="类型转换和实例判断"></a>类型转换和实例判断</h3><p>如上所述，还有一个隐喻的事实就是，泛型类被所有的实例共享，也就是说判断一个实例是不是泛型类的某种调用就是毫无意义的。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Collection cs &#x3D; new ArrayList&lt;String&gt;();</span><br><span class="line">&#x2F;&#x2F; 不合法.</span><br><span class="line">if (cs instanceof Collection&lt;String&gt;) &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">类似，还有下面叙述的转换</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Unchecked warning,</span><br><span class="line">Collection&lt;String&gt; cstr &#x3D; (Collection&lt;String&gt;) cs;</span><br></pre></td></tr></table></figure>

<p>类似的，还有类型变量。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Unchecked warning. </span><br><span class="line">&lt;T&gt; T badCast(T t, Object o) &#123;</span><br><span class="line">    return (T) o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际上，<strong>类型变量在运行期是不存在的</strong>，这意味着它们在时间和空间上都不需要性能开销，这很好。不幸的是，这也意味着类型转换中不能可靠地使用它们。</p>
<h2 id="类字面量作为运行时类型标记"><a href="#类字面量作为运行时类型标记" class="headerlink" title="类字面量作为运行时类型标记"></a>类字面量作为运行时类型标记</h2><p><code>Class</code>类也变成了泛型， 这是除了容器以外泛型的一个重要应用。<br><code>Class&lt;T&gt;</code>中的<code>T</code>代表的什么，<code>T</code>代表的是<code>class</code>所要表示的对象。<br>如<code>String.class</code>的类型是<code>Class&lt;String&gt;</code>。<code>Serializable.class</code> 的类型时<code>Class&lt;Serializable&gt;</code>。<br><code>String.class</code>类字面量，作为类型<code>Class&lt;String&gt;</code>的标记。</p>
<p>很自然的我们可以使用类字面量作为工厂对象被反射使用，如下述例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Collection emps &#x3D; sqlUtility.select(EmpInfo.class, &quot;select * from emps&quot;);</span><br><span class="line">...</span><br><span class="line">public static Collection select(Class c, String sqlStatement) &#123; </span><br><span class="line">    Collection result &#x3D; new ArrayList();</span><br><span class="line">    &#x2F;* Run sql query using jdbc. *&#x2F;</span><br><span class="line">    for (&#x2F;* Iterate over jdbc results. *&#x2F; ) &#123; </span><br><span class="line">        Object item &#x3D; c.newInstance(); </span><br><span class="line">        &#x2F;* Use reflection and set all of item&#39;s</span><br><span class="line">         * fields from sql results. </span><br><span class="line">         *&#x2F;  </span><br><span class="line">        result.add(item); </span><br><span class="line">    &#125; </span><br><span class="line">    return result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这种方式不能完全返回我们想要的精确类型的集合，但现在<code>Class</code>引入了泛型。我们可以使用如下的方式代替：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Collection&lt;EmpInfo&gt; </span><br><span class="line">    emps &#x3D; sqlUtility.select(EmpInfo.class, &quot;select * from emps&quot;);</span><br><span class="line">...</span><br><span class="line">public static &lt;T&gt; Collection&lt;T&gt; select(Class&lt;T&gt; c, String sqlStatement) &#123; </span><br><span class="line">    Collection&lt;T&gt; result &#x3D; new ArrayList&lt;T&gt;();</span><br><span class="line">    &#x2F;* Run sql query using jdbc. *&#x2F;</span><br><span class="line">    for (&#x2F;* Iterate over jdbc results. *&#x2F; ) &#123; </span><br><span class="line">        T item &#x3D; c.newInstance(); </span><br><span class="line">        &#x2F;* Use reflection and set all of item&#39;s</span><br><span class="line">         * fields from sql results. </span><br><span class="line">         *&#x2F;  </span><br><span class="line">        result.add(item);</span><br><span class="line">    &#125; </span><br><span class="line">    return result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="下边界通配符"><a href="#下边界通配符" class="headerlink" title="下边界通配符"></a>下边界通配符</h2><p>看下面一个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">interface Sink&lt;T&gt; &#123;</span><br><span class="line">    flush(T t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T&gt; T writeAll(Collection&lt;T&gt; coll, Sink&lt;T&gt; snk) &#123;</span><br><span class="line">    T last;</span><br><span class="line">    for (T t : coll) &#123;</span><br><span class="line">        last &#x3D; t;</span><br><span class="line">        snk.flush(last);</span><br><span class="line">    &#125;</span><br><span class="line">    return last;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Sink&lt;Object&gt; s;</span><br><span class="line">Collection&lt;String&gt; cs;</span><br><span class="line">String str &#x3D; writeAll(cs, s); &#x2F;&#x2F; 错误调用.</span><br></pre></td></tr></table></figure>

<p>上述的<code>writeAll</code>调用是不合法的，她的形参类型都包含类型变量<code>T</code>。这种情况下，<code>T</code>不会被推断为合适的类型。并且<code>String</code>和<code>Object</code>都不满足条件，因为<code>T</code>要为同一类型。<br>如何改写<code>writeAll</code>方法呢？如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T&gt; T writeAll(Collection&lt;T&gt; coll, Sink&lt;? super T&gt; snk) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>? super T</code>表示未知类型必须是<code>T</code>类型的父类，这样将可以满足条件。 </p>
<h3 id="通配符的匹配（wildcard-capture）"><a href="#通配符的匹配（wildcard-capture）" class="headerlink" title="通配符的匹配（wildcard capture）"></a>通配符的匹配（wildcard capture）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;?&gt; unknownSet &#x3D; new HashSet&lt;String&gt;();</span><br><span class="line">class Collections &#123;</span><br><span class="line">    ...</span><br><span class="line">    &lt;T&gt; public static Set&lt;T&gt; unmodifiableSet(Set&lt;T&gt; set) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">Set&lt;?&gt; s &#x3D; Collections.unmodifiableSet(unknownSet);</span><br></pre></td></tr></table></figure>
<p>上述方式介绍了一种新的特殊规则，同时符合类型安全的策略，即通配符的匹配。即编译器可以把<code>?</code>推断为<code>T</code>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/01/usage-phantomjs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/02/01/usage-phantomjs/" class="post-title-link" itemprop="url">phantomjs使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-02-01 22:02:43" itemprop="dateCreated datePublished" datetime="2019-02-01T22:02:43+08:00">2019-02-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>phantomjs是一个无头浏览器，也就是没有gui，是一个基于webkit的JavaScript API。<br>它使用QtWebKit作为它核心浏览器的功能，使用webkit来编译解释执行JavaScript代码。<br>任何你可以在基于webkit浏览器做的事情，它都能做到。</p>
</blockquote>
<h1 id="phantomjs常用功能"><a href="#phantomjs常用功能" class="headerlink" title="phantomjs常用功能"></a>phantomjs常用功能</h1><ul>
<li><p>页面自动化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.open(<span class="string">'http://www.sample.com'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  page.includeJs(<span class="string">"http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    page.evaluate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $(<span class="string">"button"</span>).click();</span><br><span class="line">    &#125;);</span><br><span class="line">    phantom.exit()</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上述操作加载了一个页面并且自动执行的$(“button”).click()事件</p>
</li>
<li><p>屏幕抓取</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.open(<span class="string">'http://github.com/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  page.render(<span class="string">'github.png'</span>);</span><br><span class="line">  phantom.exit();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上述操作加载了一个页面并且自动生成和保存为github.png图片，图片名称和页面路径都可以通过参数形式指定，另外还可以生成其他图片或pdf格式</p>
</li>
<li><p>功能性测试</p>
</li>
<li><p>网络监控</p>
</li>
</ul>
<h1 id="phantomjs注意事项"><a href="#phantomjs注意事项" class="headerlink" title="phantomjs注意事项"></a>phantomjs注意事项</h1><p>phantomjs常被用来进行html转图片操作，也就是程序开发中的<code>生成分享海报</code>。<br>值得注意的是，如果一个html声明页面字体phantomjs则会去系统上找寻对应的字体。<br>如果没有找寻到则会使用默认字体，也就是说。<br>如果声明了字体，则系统上必须有该字体，如果没有，<strong>生成一个图片的时长消耗也会加大，影响效率</strong>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/22/usage-zookeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/22/usage-zookeeper/" class="post-title-link" itemprop="url">zookeeper使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-22 20:01:36" itemprop="dateCreated datePublished" datetime="2018-12-22T20:01:36+08:00">2018-12-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="zk伪集群安装"><a href="#zk伪集群安装" class="headerlink" title="zk伪集群安装"></a>zk伪集群安装</h2><ul>
<li>1 百度云下载zkcluster.tar.gz（安装之后打包的文件，保存以供后期快速使用）</li>
<li>2 上传linux服务器解压</li>
<li>3 确认根据目录图片确认当前目录是否准确</li>
<li>4 修改conf配置 zoo.cfg的ip配置</li>
<li>5 使用命令启动，查看状态</li>
</ul>
<h2 id="zk常用命令"><a href="#zk常用命令" class="headerlink" title="zk常用命令"></a>zk常用命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zk_4507/bin/zkServer.sh start zk_4507/conf/zoo.cfg    #启动</span><br><span class="line">zk_4506/bin/zkServer.sh start zk_4506/conf/zoo.cfg    #启动  </span><br><span class="line">zk_4505/bin/zkServer.sh start zk_4505/conf/zoo.cfg    #启动</span><br><span class="line"></span><br><span class="line">zk_4505/bin/zkCli.sh -server 127.0.0.1:4505    #链接</span><br><span class="line">zk_4506/bin/zkServer.sh status    #查看  zookeeper配置和角色信息</span><br></pre></td></tr></table></figure>
<blockquote>
<p>NOTE:具体路径操作命令：<code>-h</code> 查询帮助</p>
</blockquote>
<h2 id="zk配额机制"><a href="#zk配额机制" class="headerlink" title="zk配额机制"></a>zk配额机制</h2><p>-n  设置子节点的数量，包括其自身。<br>-b  节点中数据的长度(byte)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setquota -n 10 &#x2F;test_quota    #设置配额</span><br><span class="line">listquota  &#x2F;test_quota    #查看配额</span><br><span class="line">delquota -n &#x2F;test_quota    #删除配额</span><br></pre></td></tr></table></figure>

<h2 id="zk三种数据存储机制"><a href="#zk三种数据存储机制" class="headerlink" title="zk三种数据存储机制"></a>zk三种数据存储机制</h2><p>-s: sequence 模式, 创建后会生成原节点+序列号的节点，再次执行相同命令会产生序列号加1的节点。<br>-e: 临时节点与数据, 关闭连接后数据就会被删除。</p>
<h2 id="什么是命名服务？"><a href="#什么是命名服务？" class="headerlink" title="什么是命名服务？"></a>什么是命名服务？</h2><p>是指通过指定的名字来获取资源或者服务的地址，提供者的信息。<br>利用Zookeeper很容易创建一个全局的路径，而这个路径就可以作为一个名字，它可以指向集群中的集群，提供的服务的地址，远程对象等。<br>简单来说使用Zookeeper做命名服务就是用路径作为名字，路径上的数据就是其名字指向的实体。<br>服务提供者在启动的时候，向zk上的指定节点/dubbo/${serviceName}/providers目录下写入自己的URL地址，这个操作就完成了服务的发布。<br>服务消费者启动的时候，订阅/dubbo/{serviceName}/providers目录下的提供者URL地址， 并向/dubbo/{serviceName} /consumers目录下写入自己的URL地址。<br>注意，所有向zk上注册的地址都是临时节点，这样就能够保证服务提供者和消费者能够自动感应资源的变化。<br>另外，Dubbo还有针对服务粒度的监控，方法是订阅/dubbo/{serviceName}目录下所有提供者和消费者的信息。   </p>
<h2 id="什么是znode"><a href="#什么是znode" class="headerlink" title="什么是znode?"></a>什么是znode?</h2><p>znode维持一个stat结构，它包含数据变化的版本号、ACL变化和时间戳，以允许cache校验和协调化的更新。<br>每当znode的数据变化时，版本号将增加。一个客户端收到数据时，它也会收到数据的版本号。<br>保存在每个znode中的数据都是自动读写的。读操作获取znode的所有数据，写操作替换掉znode的所有数据。每个节点有一个 访问控制表（ACL）来限制谁能做哪些操作。<br>Regular ZNode: 常规型ZNode, 用户需要显式的创建、删除。<br>Ephemeral ZNode: 临时型ZNode, 用户创建它之后，可以显式的删除，也可以在创建它的Session结束后，由ZooKeeper Server自动删除。<br>ZNode还有一个Sequential的特性，如果创建的时候指定的话，该ZNode的名字后面会自动Append一个不断增加的SequenceNo。</p>
<h2 id="znode中stat的解释"><a href="#znode中stat的解释" class="headerlink" title="znode中stat的解释"></a>znode中stat的解释</h2><ul>
<li>czxid. 节点创建时的zxid.</li>
<li>mzxid. 节点最新一次更新发生时的zxid.</li>
<li>ctime. 节点创建时的时间戳.</li>
<li>mtime. 节点最新一次更新发生时的时间戳.</li>
<li>dataVersion. 节点数据的更新次数.</li>
<li>cversion. 其子节点的更新次数.</li>
<li>aclVersion. 节点ACL(授权信息)的更新次数.</li>
<li>ephemeralOwner. 如果该节点为ephemeral节点, ephemeralOwner值表示与该节点绑定的session id. 如果该节点不是ephemeral节点, ephemeralOwner值为0. </li>
<li>dataLength. 节点数据的字节数.</li>
<li>numChildren. 子节点个数.</li>
</ul>
<h2 id="znode中acl-access-control-lists"><a href="#znode中acl-access-control-lists" class="headerlink" title="znode中acl(access control lists)"></a>znode中acl(access control lists)</h2><ul>
<li>针对节点可以设置相关读写等权限，目的是为了保障数据安全性</li>
<li>权限permissions可以指定不同的权限范围以及角色</li>
</ul>
<h3 id="acl的构成"><a href="#acl的构成" class="headerlink" title="acl的构成"></a>acl的构成</h3><p>zk的acl通过 [scheme:id:permissions] 来构成权限列表：</p>
<ul>
<li>scheme：代表采用的某种权限机制    </li>
</ul>
<p>world：<strong>world</strong>(默认的都为world)下只有一个id，即只有一个用户，也就是anyone，那么组合的写法就是 world:anyone:[permissions]<br>ip：当设置为ip指定的ip地址，此时限制ip进行访问，比如ip:192.168.77.130:[permissions]<br>auth：代表认证登录，需要注册用户获取权限后才可以登录访问，形式为 auth:user:password:[permissions]<br>digest：需要对密码加密才能访问，组合形式为：digest:username:BASE64(SHA1(password)):[permissions]<br>super：代表超级管理员，拥有所有的权限。  </p>
<blockquote>
<p>auth与digest的区别就是，前者使用明文密码进行登录，后者使用密文密码进行登录。setAcl /path auth:lee:lee:cdrwa<br>与 setAcl /path digest:lee:BASE64(SHA1(password)):cdrwa是等价的，在通过 addauth digest lee:lee 后都能操作指定节点的权限。在实际情况中，digest要更为常用一些。</p>
</blockquote>
<ul>
<li>id：代表允许访问的用户</li>
<li>permissions：权限组合字符串</li>
</ul>
<p>权限字符串缩写 crdwa ：<br>CREATE：创建子节点权限<br>READ：访问节点/子节点权限<br>WRITE：设置节点数据权限<br>DELETE：删除子节点权限<br>ADMIN：管理员权限</p>
<h3 id="acl命令"><a href="#acl命令" class="headerlink" title="acl命令"></a>acl命令</h3><p>getAcl 获取某个节点的acl权限信息<br>setAcl 设置某个节点的acl权限信息<br>addauth 输入认证授权信息，注册时输入明文密码（登录），但是在zk的系统里，密码是以加密后的形式存在的   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addauth digest user1:123456 #添加一个认证信息</span><br></pre></td></tr></table></figure>

<h2 id="什么是session（会话）？"><a href="#什么是session（会话）？" class="headerlink" title="什么是session（会话）？"></a>什么是session（会话）？</h2><p>Client与ZooKeeper之间的通信，需要创建一个Session，这个Session会有一个超时时间。因为ZooKeeper集群会把Client的Session信息持久化，所以在Session没超时之前，<br>Client与ZooKeeper Server的连接可以在各个ZooKeeper Server之间透明地移动。<br>在实际的应用中，如果Client与Server之间的通信足够频繁，Session的维护就不需要其它额外的消息了。<br>否则，ZooKeeper Client会每t/3 ms发一次心跳给Server，如果Client 2t/3 ms没收到来自Server的心跳回应，就会换到一个新的ZooKeeper Server上。<br>这里t是用户配置的Session的超时时间。</p>
<h2 id="什么是watcher？"><a href="#什么是watcher？" class="headerlink" title="什么是watcher？"></a>什么是watcher？</h2><p>ZooKeeper支持一种Watch操作，Client可以在某个ZNode上设置一个Watcher，来Watch该ZNode上的变化。如果该ZNode上有相应的变化，就会触发这个Watcher，<br>把相应的事件通知给设置Watcher的Client。需要注意的是，ZooKeeper中的Watcher是一次性的，即触发一次就会被取消，如果想继续Watch的话，需要客户端重新设置Watcher。</p>
<h2 id="zk的角色扮演"><a href="#zk的角色扮演" class="headerlink" title="zk的角色扮演"></a>zk的角色扮演</h2><p><strong>leader和follower</strong><br>ZooKeeper需要在所有的服务（可以理解为服务器）中选举出一个Leader，然后让这个Leader来负责管理集群。此时，集群中的其它服务器则成为此Leader的Follower。并且，当Leader故障的时候，需要ZooKeeper能够快速地在Follower中选举出下一个Leader。这就是ZooKeeper的Leader机制，下面我们将简单介绍在ZooKeeper中，Leader选举（Leader Election）是如何实现的。<br>此操作实现的核心思想是：首先创建一个EPHEMERAL目录节点，例如“/election”。然后。每一个ZooKeeper服务器在此目录下创建一个SEQUENCE|EPHEMERAL类型的节点，例如“/election/n_”。在SEQUENCE标志下，ZooKeeper将自动地为每一个ZooKeeper服务器分配一个比前一个分配的序号要大的序号。此时创建节点的ZooKeeper服务器中拥有最小序号编号的服务器将成为Leader。<br>在实际的操作中，还需要保障：当Leader服务器发生故障的时候，系统能够快速地选出下一个ZooKeeper服务器作为Leader。一个简单的解决方案是，让所有的follower监视leader所对应的节点。当Leader发生故障时，Leader所对应的临时节点将会自动地被删除，此操作将会触发所有监视Leader的服务器的watch。这样这些服务器将会收到Leader故障的消息，并进而进行下一次的Leader选举操作。但是，这种操作将会导致“从众效应”的发生，尤其当集群中服务器众多并且带宽延迟比较大的时候，此种情况更为明显。<br>在Zookeeper中，为了避免从众效应的发生，它是这样来实现的：每一个follower对follower集群中对应的比自己节点序号小一号的节点（也就是所有序号比自己小的节点中的序号最大的节点）设置一个watch。只有当follower所设置的watch被触发的时候，它才进行Leader选举操作，一般情况下它将成为集群中的下一个Leader。很明显，此Leader选举操作的速度是很快的。因为，每一次Leader选举几乎只涉及单个follower的操作。</p>
<p><strong>observer</strong><br>observer的行为在大多数情况下与follower完全一致, 但是他们不参加选举和投票, 而仅仅接受(observing)选举和投票的结果.</p>
<h2 id="zk特性"><a href="#zk特性" class="headerlink" title="zk特性"></a>zk特性</h2><h3 id="读、写-更新-模式"><a href="#读、写-更新-模式" class="headerlink" title="读、写(更新)模式"></a>读、写(更新)模式</h3><p>在ZooKeeper集群中，读可以从任意一个ZooKeeper Server读，这一点是保证ZooKeeper比较好的读性能的关键；<br>写的请求会先Forwarder到Leader，然后由Leader来通过ZooKeeper中的原子广播协议，将请求广播给所有的Follower，Leader收到一半以上的写成功的Ack后，<br>就认为该写成功了，就会将该写进行持久化，并告诉客户端写成功了。</p>
<h3 id="WAL和Snapshot"><a href="#WAL和Snapshot" class="headerlink" title="WAL和Snapshot"></a>WAL和Snapshot</h3><p>和大多数分布式系统一样，ZooKeeper也有WAL(Write-Ahead-Log)，对于每一个更新操作，ZooKeeper都会先写WAL,<br>然后再对内存中的数据做更新，然后向Client通知更新结果。另外，ZooKeeper还会定期将内存中的目录树进行Snapshot，<br>落地到磁盘上，这个跟HDFS中的FSImage是比较类似的。这么做的主要目的，一当然是数据的持久化，二是加快重启之后的恢复速度，<br>如果全部通过Replay WAL的形式恢复的话，会比较慢。</p>
<h3 id="FIFO"><a href="#FIFO" class="headerlink" title="FIFO"></a>FIFO</h3><p>对于每一个ZooKeeper客户端而言，所有的操作都是遵循FIFO顺序的，<br>这一特性是由下面两个基本特性来保证的：一是ZooKeeper Client与Server之间的网络通信是基于TCP，TCP保证了Client/Server之间传输包的顺序；二是ZooKeeper Server执行客户端请求也是严格按照FIFO顺序的。</p>
<h3 id="Linearizability"><a href="#Linearizability" class="headerlink" title="Linearizability"></a>Linearizability</h3><p>在ZooKeeper中，所有的更新操作都有严格的偏序关系，更新操作都是串行执行的，这一点是保证ZooKeeper功能正确性的关键。</p>
<h2 id="zab介绍"><a href="#zab介绍" class="headerlink" title="zab介绍"></a>zab介绍</h2><p>ZooKeeper服务的内部通信，是基于Zab协议，即ZooKeeper Atomic Broadcast协议。原子广播(AB)是分布式计算普遍使用的原语。本质上说，ZooKeeper服务是基于复制分发的。<br>它需要半数以上的服务器能正常工作。崩溃的服务器能恢复并且重新加入集群。ZooKeeper采用主备方式来维护被复制状态的一致性。<br>在ZooKeeper中，leader接受所有客户的请求并加以执行，然后将增量的状态变化，以事务的方式通过Zab复制到所有的followers。<br>一旦leader崩溃，在进行常规操作之前，必须执行一套恢复协议，来a). 协调各followers达到一致状态，b). 选举出新的leader。<br>为了选举出leader，新的leader必须得到多数支持(quorum)。由于zookeeper server随时都可能崩溃或恢复，随时间流逝，同一个进程可能好几次成为leader。<br>为了能区分随时间变化的不同的leader实例，ZooKeeper为每一个leader都分配一个实例值。一个leader实例值最多能映射到一个进程。<br>对Zab设计而言很关键的一点是，对于每个状态变化的观察，都是基于上一个状态的增量变化。这也就意味着对于状态变化，必须依赖于其更新的次序。状态改变过程是不能乱序的。<br>只要增量的发送是有序的，状态的更新便是幂等的，即使某个增量变化被反复执行多次。<br>因此，对于消息系统而言，保证at-least once语义已经足够，以此来简化整个Zab的实现。<br>Zab是Zookeeper核心的重要组件，因此必须高效运行。ZooKeeper被设计成能支持高吞吐量、低时延的系统。应用能广泛地在集群环境下使用Zookeeper，能接受来自不同数据中心大量的客户端连接。<br>在设计zookeeper过程中，我们发现很难在隔离的环境下解释清楚原子广播，必定要提及必须满足的应用的需求和目标。在解释原子广播必须涉及应用，这导致了不同的协议元素，甚至是一些有意思的优化。<br>Zookeeper所使用的zad协议也是类似paxos协议的。所有分布式自协商一致性算法都是paxos算法的简化或者变种。</p>
<h2 id="zk典型应用场景"><a href="#zk典型应用场景" class="headerlink" title="zk典型应用场景"></a>zk典型应用场景</h2><ol>
<li><p>名字服务(Name Service)<br>分布式应用中，通常需要一套完备的命令机制，既能产生唯一的标识，又方便人识别和记忆。 我们知道，每个ZNode都可以由其路径唯一标识，路径本身也比较简洁直观，另外ZNode上还可以存储少量数据，这些都是实现统一的NameService的基础。</p>
</li>
<li><p>配置管理(Configuration Management)<br>在分布式系统中，常会遇到这样的场景: 某个Job的很多个实例在运行，它们在运行时大多数配置项是相同的，如果想要统一改某个配置，一个个实例去改，是比较低效，也是比较容易出错的方式。通过ZooKeeper可以很好的解决这样的问题，下面的基本的步骤：</p>
</li>
<li><p>组员管理(Group Membership)<br>在典型的Master-Slave结构的分布式系统中，Master需要作为“总管”来管理所有的Slave, 当有Slave加入，或者有Slave宕机，Master都需要感知到这个事情，然后作出对应的调整，以便不影响整个集群对外提供服务。</p>
</li>
<li><p>简单互斥锁(Simple Lock)<br>我们知识，在传统的应用程序中，线程、进程的同步，都可以通过操作系统提供的机制来完成。但是在分布式系统中，多个进程之间的同步，操作系统层面就无能为力了。<br>这时候就需要像ZooKeeper这样的分布式的协调(Coordination)服务来协助完成同步，下面是用ZooKeeper实现简单的互斥锁的步骤，这个可以和线程间同步的mutex做类比来理解：<br>多个进程尝试去在指定的目录下去创建一个临时性(Ephemeral)结点 /locks/my_lock<br>ZooKeeper能保证，只会有一个进程成功创建该结点，创建结点成功的进程就是抢到锁的进程，假设该进程为A<br>其它进程都对/locks/my_lock进行Watch<br>当A进程不再需要锁，可以显式删除/locks/my_lock释放锁；或者是A进程宕机后Session超时，ZooKeeper系统自动删除/locks/my_lock结点释放锁。此时，其它进程就会收到ZooKeeper的通知，并尝试去创建/locks/my_lock抢锁，如此循环反复</p>
</li>
<li><p>互斥锁(Simple Lock without Herd Effect)<br>上一节的例子中有一个问题，每次抢锁都会有大量的进程去竞争，会造成羊群效应(Herd Effect)，为了解决这个问题，我们可以通过下面的步骤来改进上述过程：<br>每个进程都在ZooKeeper上创建一个临时的顺序结点(Ephemeral Sequential) /locks/lock_${seq}<br>${seq}最小的为当前的持锁者(${seq}是ZooKeeper生成的Sequenctial Number)<br>其它进程都对只watch比它次小的进程对应的结点，比如2 watch 1, 3 watch 2, 以此类推<br>当前持锁者释放锁后，比它次大的进程就会收到ZooKeeper的通知，它成为新的持锁者，如此循环反复<br>这里需要补充一点，通常在分布式系统中用ZooKeeper来做Leader Election(选主)就是通过上面的机制来实现的，这里的持锁者就是当前的“主”。</p>
</li>
</ol>
<h2 id="acl四字命令"><a href="#acl四字命令" class="headerlink" title="acl四字命令"></a>acl四字命令</h2><blockquote>
<p><a href="http://zookeeper.apache.org/doc/r3.4.11/zookeeperAdmin.html#sc_zkCommands" target="_blank" rel="noopener">http://zookeeper.apache.org/doc/r3.4.11/zookeeperAdmin.html#sc_zkCommands</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/15/java-remote-debug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/15/java-remote-debug/" class="post-title-link" itemprop="url">java远程调试</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-15 09:29:27" itemprop="dateCreated datePublished" datetime="2018-06-15T09:29:27+08:00">2018-06-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>做了一个线下的产品，在生产端总是会出现各种问题，解决的时候不能一直都需要搭建一个相同的环境去模拟。记录一下之前用过的远程调试。</p>
</blockquote>
<h2 id="本地idea添加一个Remote单元，配置。"><a href="#本地idea添加一个Remote单元，配置。" class="headerlink" title="本地idea添加一个Remote单元，配置。"></a>本地idea添加一个Remote单元，配置。</h2><p><img src="http://alldios-image.test.upcdn.net/note/idea-remote-java-debug.png" alt="idea-remote-java-debug"><br>参数含义如下</p>
<ul>
<li>transport :调试程序和VM之间的通信方式， dt_socket 表示用套接字传输 </li>
<li>server=y : 表示是监听其他debug client端的请求 </li>
<li>suspend : 表示是否在调试客户端建立连接之后启动 VM。 <blockquote>
<ul>
<li>如果为y，那么当前的VM就是suspend直到有debug client连接进来才开始执行程序 </li>
<li>如果为n，那么当前的VM就会直接执行，不会等待debug client连接进来 </li>
</ul>
</blockquote>
</li>
<li>address=8778 : 表示端口是8778</li>
</ul>
<h2 id="远程服务添加代理"><a href="#远程服务添加代理" class="headerlink" title="远程服务添加代理"></a>远程服务添加代理</h2><p>catalina.sh添加</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS="$JAVA_OPTS -agentlib:jdwp=transport=dt_socket,address=8778,suspend=n,server=y"</span><br></pre></td></tr></table></figure>
<p>如图所示：<br><img src="http://alldios-image.test.upcdn.net/note/remote-server-java-config.png" alt="remote-server-java-config"></p>
<blockquote>
<p>保持本地代码和远端代码一致，在本地代码端打断点，远端执行到指定代码时，便会跳到断点处。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/07/sql-libai-diff/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/07/sql-libai-diff/" class="post-title-link" itemprop="url">database数据结构对比</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-07 12:01:36" itemprop="dateCreated datePublished" datetime="2018-05-07T12:01:36+08:00">2018-05-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>对一个需要线下实施的停车平台进行二次开发，因为数据库结构不合理，所以更新频率较高并且更新迭代记录不是很合理。因为不是线上产品，大家使用的不是一个数据库，导致项目老是因为一个字段的缺失报错，十分的不爽。</p>
</blockquote>
<h2 id="SQLDIFF下载"><a href="#SQLDIFF下载" class="headerlink" title="SQLDIFF下载"></a>SQLDIFF下载</h2><p>SQLDIFF输入数据源和目标源信息可以快速的对比数据库结构的差异，包括存储过程，触发器，函数等常用机制。<br><a href="http://www.vidarsoft.cn/download/SQLDiff.zip" target="_blank" rel="noopener">下载链接</a><br>目前支持MYSQL,MSSQL,MSSQL2000,POSTGREA等类型。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/12/note-pad++-usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/04/12/note-pad++-usage/" class="post-title-link" itemprop="url">notePad++使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-12 20:08:27" itemprop="dateCreated datePublished" datetime="2018-04-12T20:08:27+08:00">2018-04-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="查看Class文件编译版本"><a href="#查看Class文件编译版本" class="headerlink" title="查看Class文件编译版本"></a>查看Class文件编译版本</h2><blockquote>
<p>下载<a href="https://sourceforge.net/projects/npp-plugins/files/Hex%20Editor/" target="_blank" rel="noopener">HexEditor.dll</a>文件放置在$NotePad++\plugins，重启NotePad++。<br>插件 &gt;&gt; HEX Editor &gt;&gt; View in Hex，查看第一行的第7个字节进行对比。</p>
</blockquote>
<table>
<thead>
<tr>
<th>版本号</th>
<th>对应十进制</th>
<th>jdk版本号</th>
</tr>
</thead>
<tbody><tr>
<td>2E</td>
<td>46</td>
<td>jdk1.2</td>
</tr>
<tr>
<td>2F</td>
<td>47</td>
<td>jdk1.3</td>
</tr>
<tr>
<td>30</td>
<td>48</td>
<td>jdk1.4</td>
</tr>
<tr>
<td>31</td>
<td>49</td>
<td>jdk1.5</td>
</tr>
<tr>
<td>32</td>
<td>50</td>
<td>jdk1.6</td>
</tr>
<tr>
<td>33</td>
<td>51</td>
<td>jdk1.7</td>
</tr>
<tr>
<td>34</td>
<td>52</td>
<td>jdk1.8</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/31/sql-oralce-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/31/sql-oralce-install/" class="post-title-link" itemprop="url">oracle安装记录</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-31 07:53:37" itemprop="dateCreated datePublished" datetime="2018-03-31T07:53:37+08:00">2018-03-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install binutils compat-libstdc++-<span class="number">33</span> elfutils-libelf elfutils-libelf-devel glibc glibc-common glibc-devel gcc gcc-c++ libaio-devel libaio libgcc libstdc++ libstdc++-devel make sysstat unixODBC unixODBC-devel pdksh ksh libaio.i686 glibc.i686 compat-libstdc++-<span class="number">33</span>.i686 libaio-devel.i686 libgcc.i686 libstdc++.i686 unixODBC.i686 unixODBC-devel.i686</span><br></pre></td></tr></table></figure>

<h2 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget unzip <span class="built_in">net</span>-tools </span><br><span class="line">wget http://public-yum.oracle.com/public-yum-ol7.repo -O /etc/yum.repos.d/public-yum-ol7.repo</span><br><span class="line">wget http://public-yum.oracle.com/RPM-GPG-KEY-oracle-ol7 -O /etc/pki/rpm-gpg/RPM-GPG-KEY-oracle</span><br></pre></td></tr></table></figure>

<h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><h3 id="配置环境方法一（使用插件）"><a href="#配置环境方法一（使用插件）" class="headerlink" title="配置环境方法一（使用插件）"></a>配置环境方法一（使用插件）</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install oracle-rdbms-server-<span class="number">11</span>gR2-preinstall</span><br></pre></td></tr></table></figure>

<h3 id="配置环境方法二"><a href="#配置环境方法二" class="headerlink" title="配置环境方法二"></a>配置环境方法二</h3><h4 id="配置用户相关"><a href="#配置用户相关" class="headerlink" title="配置用户相关"></a>配置用户相关</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">groupadd oinstall </span><br><span class="line">groupadd dba </span><br><span class="line">useradd -g oinstall -G dba oracle </span><br><span class="line">passwd oracle</span><br><span class="line">密码：<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<h4 id="添加oracle安全限制"><a href="#添加oracle安全限制" class="headerlink" title="添加oracle安全限制"></a>添加oracle安全限制</h4><blockquote>
<p>vi /etc/security/limits.conf 末尾添加</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">oracle  soft    nproc  2047 </span><br><span class="line">oracle  hard    nproc  16384 </span><br><span class="line">oracle  soft    nofile  1024 </span><br><span class="line">oracle  hard    nofile  65536 </span><br><span class="line">oracle  soft    stack  10240</span><br></pre></td></tr></table></figure>

<h4 id="修改内核变量配置文件"><a href="#修改内核变量配置文件" class="headerlink" title="修改内核变量配置文件"></a>修改内核变量配置文件</h4><blockquote>
<p>vi /etc/sysctl.conf 添加</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fs.aio-max-nr = 1048576 </span><br><span class="line">fs.file-max = 6815744 </span><br><span class="line">kernel.shmall = 2097152 </span><br><span class="line">kernel.shmmax = 1610612736 #共享内存字节数(一般75%物理内存，此变量要根据实际情款修改)  1.5G</span><br><span class="line">kernel.shmmni = 4096 </span><br><span class="line">kernel.sem = 250 32000 100 128 </span><br><span class="line">net.ipv4.ip_local_port_range = 9000 65500 </span><br><span class="line">net.core.rmem_default = 262144 </span><br><span class="line">net.core.rmem_max = 4194304 </span><br><span class="line">net.core.wmem_default = 262144 </span><br><span class="line">net.core.wmem_max = 1048586 </span><br><span class="line">查看添加是够成功：sysctl -p</span><br></pre></td></tr></table></figure>

<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><blockquote>
<p>vim .bash_profile </p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export ORACLE_BASE=/usr/local/u01/oracle</span><br><span class="line">export ORACLE_HOME=/usr/local/u01/oracle/product/11.2.0/dbhome_1</span><br><span class="line">export ORACLE_SID=shibdz </span><br><span class="line">export NLS_LANG="american_america.ZHS16GBK"</span><br><span class="line">export NLS_DATE_FORMAT="YYYY-MM-DD HH24:Mi:SS"</span><br><span class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib</span><br><span class="line">export PATH=$ORACLE_HOME/bin:$PATH </span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>
<h2 id="创建文件夹-赋予权限"><a href="#创建文件夹-赋予权限" class="headerlink" title="创建文件夹 赋予权限"></a>创建文件夹 赋予权限</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/u01/oracle &amp;&amp; chown -R oracle:oinstall /usr/local/u01/oracle</span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/local/u01/oraInventory &amp;&amp; chown -R oracle:oinstall /usr/local/u01/oraInventory</span><br></pre></td></tr></table></figure>

<h2 id="解压文件并且赋予权限"><a href="#解压文件并且赋予权限" class="headerlink" title="解压文件并且赋予权限"></a>解压文件并且赋予权限</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip linux.x64_11gR2_database_1of2.zip &amp;&amp; unzip linux.x64_11gR2_database_2of2.zip </span><br><span class="line">chown -R oracle:oinstall /home/oracle/database</span><br></pre></td></tr></table></figure>

<h2 id="配置db-install-rsp"><a href="#配置db-install-rsp" class="headerlink" title="配置db_install.rsp"></a>配置db_install.rsp</h2><blockquote>
<p>cp -r /home/oracle/database/response /home/oracle/rsp 备份</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#我的/home/oracle/rsp/db_install.rsp</span><br><span class="line">oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0</span><br><span class="line">#INSTALL_DB_AND_CONFIG安装并自动配置数据库实例和监听 建议首次安装用这个</span><br><span class="line">#不然配置另外两个文件，新建实例和监听</span><br><span class="line">oracle.install.option=INSTALL_DB_AND_CONFIG</span><br><span class="line">ORACLE_HOSTNAME=localhost</span><br><span class="line">UNIX_GROUP_NAME=oinstall</span><br><span class="line">INVENTORY_LOCATION=/usr/local/u01/oraInventory</span><br><span class="line">SELECTED_LANGUAGES=zh_CN,en</span><br><span class="line">ORACLE_HOME=/usr/local/u01/oracle/product/11.2.0/dbhome_1</span><br><span class="line">ORACLE_BASE=/usr/local/u01/oracle</span><br><span class="line">oracle.install.db.InstallEdition=EE</span><br><span class="line">oracle.install.db.isCustomInstall=true</span><br><span class="line">oracle.install.db.customComponents=oracle.server:11.2.0.1.0,oracle.sysman.ccr:10.2.7.0.0,oracle.xdk:11.2.0.1.0,oracle.rdbms.oci:11.2.0.1.0,oracle.network:11.2.0.1.0,oracle.network.listener:11.2.0.1.0,oracle.rdbms:11.2.0.1.0,oracle.options:11.2.0.1.0,oracle.rdbms.partitioning:11.2.0.1.0,oracle.oraolap:11.2.0.1.0,oracle.rdbms.dm:11.2.0.1.0,oracle.rdbms.dv:11.2.0.1.0,orcle.rdbms.lbac:11.2.0.1.0,oracle.rdbms.rat:11.2.0.1.0</span><br><span class="line">oracle.install.db.DBA_GROUP=dba</span><br><span class="line">oracle.install.db.OPER_GROUP=oinstall</span><br><span class="line">oracle.install.db.config.starterdb.type=GENERAL_PURPOSE</span><br><span class="line">#这个是服务名</span><br><span class="line">oracle.install.db.config.starterdb.globalDBName=shibdz_ypt</span><br><span class="line">#实例sid</span><br><span class="line">oracle.install.db.config.starterdb.SID=shibdz</span><br><span class="line">oracle.install.db.config.starterdb.characterSet=AL32UTF8</span><br><span class="line">oracle.install.db.config.starterdb.memoryOption=true</span><br><span class="line">oracle.install.db.config.starterdb.memoryLimit=1024</span><br><span class="line">#是否安装学习的scott和hr(我就知道这两个)</span><br><span class="line">oracle.install.db.config.starterdb.installExampleSchemas=true</span><br><span class="line">oracle.install.db.config.starterdb.enableSecuritySettings=true</span><br><span class="line">#密码全设置成123456 (安装时会提示，个人学习忽略)</span><br><span class="line">oracle.install.db.config.starterdb.password.ALL=123456</span><br><span class="line">oracle.install.db.config.starterdb.control=DB_CONTROL</span><br><span class="line">oracle.install.db.config.starterdb.dbcontrol.enableEmailNotification=false</span><br><span class="line">oracle.install.db.config.starterdb.automatedBackup.enable=false</span><br><span class="line">oracle.install.db.config.starterdb.storageType=FILE_SYSTEM_STORAGE</span><br><span class="line">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=/usr/local/u01/oracle/oradata</span><br><span class="line">#true</span><br><span class="line">DECLINE_SECURITY_UPDATES=true</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/oracle/database/runInstaller -silent -ignorePrereq  -responseFile /home/oracle/rsp/db_install.rsp</span><br></pre></td></tr></table></figure>

<h3 id="解决-INS-35173"><a href="#解决-INS-35173" class="headerlink" title="解决 INS-35173"></a>解决 INS-35173</h3><blockquote>
<p>修改/etc/fstab  添加如下一行</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmpfs            &#x2F;dev&#x2F;shm       tmpfs  defaults,size&#x3D;3G       0 0</span><br></pre></td></tr></table></figure>

<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dbstart $ORACLE_HOME</span><br><span class="line">dbshut  $ORACLE_HOME</span><br><span class="line">lsnrctl stop、lsnrctl <span class="built_in">start</span>、lsnrctl status</span><br><span class="line">连接数据库：sqlplus / as sysdba </span><br><span class="line">shutdown immediate</span><br><span class="line">startup</span><br></pre></td></tr></table></figure>
<h3 id="监听服务配置文件展示"><a href="#监听服务配置文件展示" class="headerlink" title="监听服务配置文件展示"></a>监听服务配置文件展示</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># tnsnames.ora Network Configuration File: /usr/local/u01/oracle/product/<span class="number">11</span>.<span class="number">2</span>.<span class="number">0</span>/dbhome_1/network/admin/tnsnames.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line"></span><br><span class="line">SHIBDZ_YPT =</span><br><span class="line">  (DESCRIPTION =</span><br><span class="line">    (ADDRESS = (PROTOCOL = TCP)(HOST = <span class="number">10</span>.<span class="number">9</span>.<span class="number">4</span>.<span class="number">192</span>)(PORT = <span class="number">1521</span>))</span><br><span class="line">    (CONNECT_DATA =</span><br><span class="line">      (SERVER = DEDICATED)</span><br><span class="line">      (SERVICE_NAME = shibdz_ypt)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># listener.ora Network Configuration File: /usr/local/u01/oracle/product/<span class="number">11</span>.<span class="number">2</span>.<span class="number">0</span>/dbhome_1/network/admin/listener.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line">SID_LIST_LISTENER =</span><br><span class="line">  (SID_LIST =</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (GLOBAL_DBNAME = shibdz_ypt)</span><br><span class="line">      (ORACLE_HOME = /usr/local/u01/oracle/product/<span class="number">11</span>.<span class="number">2</span>.<span class="number">0</span>/dbhome_1)</span><br><span class="line">	  (SID_NAME = shibdz)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">LISTENER =</span><br><span class="line">  (DESCRIPTION_LIST =</span><br><span class="line">    (DESCRIPTION =</span><br><span class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = <span class="number">10</span>.<span class="number">9</span>.<span class="number">4</span>.<span class="number">192</span>)(PORT = <span class="number">1521</span>))</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">ADR_BASE_LISTENER = /usr/local/u01/oracle</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/16/java-jvm-threaddump/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="SpaceX">
      <meta itemprop="description" content="秀外慧中流砥柱">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SpaceX">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/01/16/java-jvm-threaddump/" class="post-title-link" itemprop="url">服务器隐忧排查</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-16 14:17:53" itemprop="dateCreated datePublished" datetime="2018-01-16T14:17:53+08:00">2018-01-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h1><h2 id="查询耗费进程的pid"><a href="#查询耗费进程的pid" class="headerlink" title="查询耗费进程的pid"></a>查询耗费进程的pid</h2><p>top -H</p>
<h2 id="查询该进程的线程占用情况"><a href="#查询该进程的线程占用情况" class="headerlink" title="查询该进程的线程占用情况"></a>查询该进程的线程占用情况</h2><p>top -H -p $pid<br>或者top -p $pid,shift + h 线程按照CPU排序。</p>
<h2 id="查询线程状态信息"><a href="#查询线程状态信息" class="headerlink" title="查询线程状态信息"></a>查询线程状态信息</h2><p>jstack $pid |grep $tid(需要转换为十六进制) -A 30</p>
<h2 id="jstack命令记录"><a href="#jstack命令记录" class="headerlink" title="jstack命令记录"></a>jstack命令记录</h2><p>jstack -l $pid<br>jstack -l -m $pid #to print both java and native frames (mixed mode)，打印java和本地帧。如果调用动态库的话 一定要带上该参数。</p>
<h3 id="ThreadDump文件"><a href="#ThreadDump文件" class="headerlink" title="ThreadDump文件"></a>ThreadDump文件</h3><p>jstack -l $pid | tee -a $file-path</p>
<h2 id="直接转换十六进制"><a href="#直接转换十六进制" class="headerlink" title="直接转换十六进制"></a>直接转换十六进制</h2><p>echo ‘obase=16; $pid’ | bc 或者  printf “%x\n” $pid</p>
<h2 id="显示内存模型信息"><a href="#显示内存模型信息" class="headerlink" title="显示内存模型信息"></a>显示内存模型信息</h2><p>jmap -histo:live $pid | head -n 100</p>
<h2 id="统计打印出来的Thread-Info"><a href="#统计打印出来的Thread-Info" class="headerlink" title="统计打印出来的Thread_Info"></a>统计打印出来的Thread_Info</h2><p>grep java.lang.Thread.State abnormalThreadInfo.txt | awk ‘{print $2$3$4$5}’ | sort | uniq -c</p>
<h1 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h1><h2 id="查看当前Java的进程信息"><a href="#查看当前Java的进程信息" class="headerlink" title="查看当前Java的进程信息"></a>查看当前Java的进程信息</h2><p>jps -l</p>
<h2 id="查看当前存活的对象"><a href="#查看当前存活的对象" class="headerlink" title="查看当前存活的对象"></a>查看当前存活的对象</h2><p>jmap -histo:live $pid</p>
<h2 id="打印当前的堆信息"><a href="#打印当前的堆信息" class="headerlink" title="打印当前的堆信息"></a>打印当前的堆信息</h2><p>jmap –heap $pid</p>
<h1 id="jstat命令指南"><a href="#jstat命令指南" class="headerlink" title="jstat命令指南"></a>jstat命令指南</h1><h2 id="类加载统计"><a href="#类加载统计" class="headerlink" title="类加载统计"></a>类加载统计</h2><p>jstat -class $pid   </p>
<blockquote>
<p>Loaded:加载class的数量<br>Bytes：所占用空间大小<br>Unloaded：未加载数量<br>Bytes:未加载占用空间<br>Time：时间 </p>
</blockquote>
<h2 id="类编译统计"><a href="#类编译统计" class="headerlink" title="类编译统计"></a>类编译统计</h2><p>jstat -compiler 6988  </p>
<blockquote>
<p>Compiled：编译数量。<br>Failed：失败数量<br>Invalid：不可用数量<br>Time：时间<br>FailedType：失败类型<br>FailedMethod：失败的方法 </p>
</blockquote>
<h2 id="总结统计"><a href="#总结统计" class="headerlink" title="总结统计"></a>总结统计</h2><p>jstat -gcutil $pid<br><a href="https://www.cnblogs.com/yjd_hycf_space/p/7755633.html" target="_blank" rel="noopener">jvm-各分区定义</a></p>
<h1 id="jinfo命令指南"><a href="#jinfo命令指南" class="headerlink" title="jinfo命令指南"></a>jinfo命令指南</h1><h2 id="查看某进程的参数信息"><a href="#查看某进程的参数信息" class="headerlink" title="查看某进程的参数信息"></a>查看某进程的参数信息</h2><p>jinfo -flags $pid</p>
<h2 id="筛选某进程的某一参数信息"><a href="#筛选某进程的某一参数信息" class="headerlink" title="筛选某进程的某一参数信息"></a>筛选某进程的某一参数信息</h2><p>jinfo -flag MaxHeapSize $pid    #此参数已经在JAVA8中过期了，转换为了metaspace。</p>
<blockquote>
<p>jinfo还可以直接更改参数的值，使用在生产情况。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SpaceX"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">SpaceX</p>
  <div class="site-description" itemprop="description">秀外慧中流砥柱</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/_heart_k/" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;_heart_k&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-instagram"></i>Instagram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/Zalldios" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;Zalldios" rel="noopener" target="_blank"><i class="fa fa-fw fa-git"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/ChaojieDZhao" title="Github → https:&#x2F;&#x2F;github.com&#x2F;ChaojieDZhao" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>Github</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/12295853" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;12295853" rel="noopener" target="_blank"><i class="fa fa-fw fa-youtube-play"></i>Bilibili</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SpaceX</span>
</div>

<a href="http://www.beian.miit.gov.cn/"  style="color:#f72b07" target="_blank">豫ICP备16002676号-1</a>
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

</body>
</html>
